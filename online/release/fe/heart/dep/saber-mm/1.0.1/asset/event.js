define("saber-mm/event",["require","saber-dom","saber-lang/extend"],function(require){function e(e){var t;return y.some(function(r){if(r.detect(e))t=r;return!!t}),t}function t(e,t,r){var n=!1,i=h.queryAll(t,r);return i.some(function(t){return n=t===e}),n}function r(e,r){for(var n=r.target,i=r.type,o=[],s=e.handlers[i]||[];s.delegateCount&&n&&n!==e.ele;){for(var a,u=s.delegateCount,c=0;u>c&&(a=s[c]);c++)if(t(n,a.selector,e.ele)){var l=d({},a);l.thisArg=n,o.push(l)}n=n.parentNode}return o=o.concat(s.slice(s.delegateCount||0))}function n(e){return function(t){var n=r(e,t);t=s(t),n.some(function(r){var n=r.thisArg||e.ele,i=r.fn.call(n,t);if(i===!1)t.preventDefault(),t.stopPropagation();return t.isPropagationStopped()})}}function i(t,r){var n=t.commonEventHandler,i=e(r);if(i)i.on(t.ele,r,n);else t.ele.addEventListener(r,n,!1)}function o(t,r){var n=t.commonEventHandler,i=e(r);if(i)i.off(t.ele,r,n);else t.ele.removeEventListener(r,n,!1)}function s(e){var t=e.stopPropagation;return e.stopPropagation=function(){t.call(this),e[v]=!0},e.isPropagationStopped=function(){return!!e[v]},e}function a(e){return e[m]}function u(e){var t=++g;return e[m]=t,t}function c(e){try{delete e[m]}catch(t){}}function l(e){this.uid=u(e),this.ele=e,this.handlers={},this.commonEventHandler=n(this),b[this.uid]=this}function f(e){var t=a(e);if(t)return b[t];else return new l(e)}function p(e){var t,r=a(e);if(r)t=b[r];return t}var h=require("saber-dom"),d=require("saber-lang/extend"),m="_event_uid",v="_stopped",g=0,y=[],b={};l.prototype.on=function(e,t,r){if(!r)r=t,t=void 0;var n=this.handlers[e];if(!n)n=this.handlers[e]=[],n.delegateCount=0,i(this,e);var o={fn:r,selector:t};if(t)n.delegateCount++,n.splice(n.delegateCount-1,0,o);else n.push(o)},l.prototype.off=function(e,t,r){if(!r)r=t,t=void 0;var n=this.handlers[e]||[];if(n.some(function(e,i){var o=!1;if(e.fn===r&&e.selector===t)n.splice(i,1),o=!0;return o}),n.length<=0)o(this,e)},l.prototype.dispose=function(){var e=this;c(e.ele),Object.keys(e.handlers).forEach(function(t){o(e,t)}),this.ele=null};var exports={};return exports.on=function(e,t,r,n){var i=f(e);i.on(t,r,n)},exports.off=function(e,t,r,n){var i=p(e);if(i)i.off(t,r,n)},exports.one=function(e,t,r,n){if(!n)n=r,r=void 0;var i=function(){var o=Array.prototype.slice.call(arguments),s=n.apply(this,o);return exports.off(e,t,r,i),s};exports.on(e,t,r,i)},exports.clear=function(e){var t=p(e);if(t)t.dispose()},exports.register=function(e){if(e.init)e.init();y.push(e)},exports});