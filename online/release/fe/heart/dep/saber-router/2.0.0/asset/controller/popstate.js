define("saber-router/controller/popstate",["require","../URL","../config"],function(require){function e(e,t){if(!u||!e.equal(u)||t.force)a(e,t),u=e}function t(e){var t=l.root;if("/"===e.charAt(0)&&t)if(0===e.indexOf(t))e=e.replace(t,"");else{var n=t.split("/").slice(1);n=n.map(function(){return".."}),e=n.join("/")+e,u=null}return e}function n(e,n){if(!e)e=t(location.pathname);return new c(e,{query:n,base:u})}function r(r){r=r||{};var i=t(location.pathname);if(location.search.length>1)i+=location.search;if(i=n(i),i.outRoot)return s(i.toString(),!0);else return void e(i,r.state||{})}function i(e){var t=e.getAttribute("target"),n=e.getAttribute("href");if(n&&(!t||"_self"===t))return"#"!==n.charAt(0)&&n.indexOf(":")<0&&n;else return void 0}function o(e){var n=e.target;if(e.path){for(var r,o=0;r=e.path[o];o++)if("A"===r.tagName){n=r;break}}else for(;n&&"A"!==n.tagName;)n=n.parentNode;if(n){var s=i(n);if(s)exports.redirect(t(s)),e.preventDefault()}}function s(e,t){if(exports.dispose(),t)location.replace(e);else location.href=e}var a,u,c=require("../URL"),l=require("../config"),exports={};return exports.init=function(e){window.addEventListener("popstate",r,!1),document.body.addEventListener("click",o,!1),a=e,r()},exports.redirect=function(t,r,i){if(i=i||{},t=n(t,r),t.outRoot)return s(t.toString());if(!u.equalWithFragment(t)&&!i.silent)history.pushState(i,i.title,t.toString());e(t,i)},exports.reset=function(t,r,i){if(i=i||{},t=n(t,r),t.outRoot)return s(t.toString());if(!i.silent)e(t,i);else u=t;history.replaceState(i,i.title,t.toString())},exports.dispose=function(){window.removeEventListener("hashchange",r,!1),document.body.removeEventListener("click",o,!1),u=null},exports});