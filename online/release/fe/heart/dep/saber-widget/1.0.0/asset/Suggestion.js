define("saber-widget/Suggestion",["require","saber-lang","saber-dom","saber-ajax","saber-promise","./Widget","./main"],function(require){function e(){this.attrs={source:{value:"http://suggestion.baidu.com/su?json=1"},param:{value:"wd"},jsonp:{value:"cb"},history:{value:!1},confirmClearHistory:{value:!1},autoClose:{value:!0}},this.states={show:!1},s.apply(this,arguments)}function t(e,t){t=t||{},t.key=t.key||"callback";var n=new o,r="S_CB_"+Math.random().toString(12).substr(2),i=document.createElement("script");e=e+"&"+t.key+"="+r,window[r]=function(){return function(e){try{n.resolve(e)}catch(t){n.reject(t)}finally{if(window[r]=null,delete window[r],i)i.parentNode.removeChild(i)}}}(),i.src=e,i.async=!0;var s=document.getElementsByTagName("head")[0]||document.body;return s.appendChild(i),s=null,n.promise()}var n=require("saber-lang"),r=require("saber-dom"),i=require("saber-ajax"),o=require("saber-promise"),s=require("./Widget");return e.prototype={type:"Suggestion",initDom:function(){var e=this,t=e.get("main");if(!e.get("sug")){var n=document.createElement("div");r.setData(n,"role","sug"),t.appendChild(n),e.set("sug",n)}e.get("input")||e.set("input",r.query("[data-role=input]",t));var i=e.get("input");if(i)i.setAttribute("autocomplete","off");e.get("search")||e.set("search",r.query("[data-role=search]",t)),e.get("reset")||e.set("reset",r.query("[data-role=reset]",t))},initEvent:function(){var e=this,t=e.get("input");e.addEvent(t,"input",n.bind(e.getSug,this)),e.get("sugRenderer")||e.set("sugRenderer",e._getSugRenderer());var r=e.get("reset");if(r)e.addEvent(r,"click",function(){t.value="",e.hide()});e.addEvent(e.get("sug"),"click",function(t){e.emit("select",t)})},getSug:function(){var e=this,t=e._getReqHandler();t.then(function(t){e.emit("request",t),e.renderSug(t)})},_getSugRenderer:function(){function e(e,t){return e.replace(t,"<em>"+t+"</em>")}var t='<ul data-role="ul">{#list}</ul>';return function(n){var r=[],i=n.q,o=n.s;for(var s in o)r.push('<li data-key="'+o[s]+'" >'+e(o[s],i)+"</li>");return t.replace("{#list}",r.join(""))}},renderSug:function(e){var t=this,n=t.get("sugRenderer");t.get("sug").innerHTML=n(e),t.show()},_getReqHandler:function(){var e=this,n=e.get("source"),r=e.get("param"),o=e.get("input").value;n+=(n.indexOf("?")>-1?"&":"?")+r+"="+o;var s=e.get("request");if(s)return s(n);else if(e.get("jsonp"))s=t(n,{key:e.get("jsonp")});else s=i.get(n);return s},initHistory:function(){},getHistory:function(){},setHistory:function(){},clearHistory:function(){},show:function(){var e=this;if(!e.is("show"))r.show(e.get("sug")),e.addState("show"),e.emit("show");return e},hide:function(){var e=this;if(e.is("show"))r.hide(e.get("sug")),e.removeState("show"),e.emit("hide");return e}},n.inherits(e,s),require("./main").register(e),e});