define("saber-widget/LazyLoad",["require","saber-lang","saber-dom","./Widget","saber-lang/function/debounce","./main"],function(require){function e(){this.attrs={attribute:{value:"data-original"},events:{value:"scroll touchmove resize orientationchange"},animate:{value:!1},range:{value:100},placeholder:{value:["data:image/png;base64,","iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8","YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"].join("")}},this.states={complete:!1},o.apply(this,arguments)}function t(e,t,r){r=r||0;var o,s;if(t)o=i.position(e,t),s=t.getBoundingClientRect();else o=e.getBoundingClientRect(),s=n();return o.top>0?o.top-r<s.height:o.top+r>0&&o.left>0?o.left-r<s.width:o.left+r>0}function n(){var e=window,t=document,n="BackCompat"===t.compatMode?t.body:t.documentElement;return{top:0,left:0,width:e.innerWidth||n.clientWidth,height:e.innerHeight||n.clientHeight}}var r=require("saber-lang"),i=require("saber-dom"),o=require("./Widget"),s=require("saber-lang/function/debounce");return e.prototype={type:"LazyLoad",initDom:function(){if(this.container=this.get("main"),this.main=this.get("main")||document.body,this.elements=this._filterElements(),this.get("placeholder"))this.elements.forEach(function(e){e.src=this.get("placeholder")},this)},initEvent:function(){var e=this;this.get("events").split(" ").forEach(function(t){e.addEvent(e.container||window,t,e._update)}),this._update()},_filterElements:function(){return i.queryAll("["+this.get("attribute")+"]",this.main)},refresh:function(){this.elements=this._filterElements(),this.removeState("complete")},_loadElement:function(e){if(this.get("animate"))i.setStyle(e,"opacity",0),i.setStyle(e,"transition","opacity .5s linear 0s"),this.addEvent(e,"load",function(){i.setStyle(e,"opacity",1)});var t=e.getAttribute(this.get("attribute"));if("IMG"===e.tagName.toUpperCase())e.src=t;else i.setStyle(e,"background-image","url("+t+")");this.emit("load",e)},_update:s(function(){var e=this;if(this.elements=this.elements.filter(function(n){if(n)if(!n.parentNode)return!1;else if(t(n,e.container,e.get("range")))return e._loadElement(n),!1;return!0}),this.emit("change"),!this.is("complete")&&!this.elements.length)this.addState("complete"),this.emit("complete")},200)},e.isElementInViewport=t,r.inherits(e,o),require("./main").register(e),e});