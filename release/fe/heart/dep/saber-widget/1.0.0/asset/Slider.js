define("saber-widget/Slider",["require","exports","module","saber-lang","saber-dom","hammer","./Widget","./main"],function(require){function e(){this.attrs={animate:{value:!0},auto:{value:!0,repaint:!0},interval:{value:4e3},flex:{value:!1,repaint:!0},index:{value:0},speed:{value:300},switchAt:{value:.5},length:{readOnly:!0,getter:function(){return this.runtime.length||0}}},this.states={stop:!0},o.apply(this,arguments)}function t(e,t,n){if(t=t||"width",arguments.length>2)return r.setStyle(e,t,(parseInt(n,10)||0)+"px");else return parseInt(r.getStyle(e,t),10)||0}var n=require("saber-lang"),r=require("saber-dom"),i=require("hammer"),o=require("./Widget");return e.prototype={type:"Slider",initDom:function(){var e=this.get("main"),t=r.query("[data-role=wrapper]",e)||r.children(e)[0];if(t)r.setData(t,"role","wrapper"),r.children(t).forEach(function(e){r.setData(e,"role","item")});this.runtime.wrapper=t},initEvent:function(){var e="release touch dragleft dragright swipeleft swiperight",t=this.runtime;t.hammer=new i(t.wrapper,{dragLockToAxis:!0}).on(e,t.handler=n.bind(this._handleHammer,this)),this.on("beforedispose",function(){t.hammer.off(e,t.handler)})},repaint:function(e){if(o.prototype.repaint.call(this,e),!e)return void this._resize(!0).enable();if(e.hasOwnProperty("auto"))this[e.auto[1]?"start":"stop"](!0);if(e.hasOwnProperty("flex"))this[e.flex[1]?"enablePlugin":"disablePlugin"]("SliderFlex","flex")},enable:function(){if(this.is("disable")&&this.is("render")){this.start();var e=this.runtime.hammer;if(e)e.enable(!0);if(this.get("flex"))this.enablePlugin("SliderFlex","flex")}return o.prototype.enable.call(this),this},disable:function(){if(!this.is("disable")&&this.is("render")){this.stop();var e=this.runtime.hammer;if(e)e.enable(!1);if(this.get("flex"))this.disablePlugin("SliderFlex")}return o.prototype.disable.call(this),this},_handleHammer:function(e){var t=e.gesture,n=e.type;if("touch"!==n)t.preventDefault();var r=this.runtime,i=r.width,o=this.get("index"),s=this.get("length");switch(n){case"touch":if(r.needResume=!this.is("pause")&&!this.is("stop"),r.needResume)this.pause();break;case"dragright":case"dragleft":var a=this._percent(o),u=100/i*t.deltaX/s;if(0===o&&"right"===t.direction||o===s-1&&"left"===t.direction)u*=.4;this._move(u+a);break;case"swipeleft":if(t.stopDetect(),this.next(),r.needResume)this.resume();break;case"swiperight":if(t.stopDetect(),this.prev(),r.needResume)this.resume();break;case"release":if(Math.abs(t.deltaX)>i*this.get("switchAt"))this["right"===t.direction?"prev":"next"]();else this.to(o);if(r.needResume)this.resume()}},_percent:function(e){var t=this.get("length");return e=Math.max(0,Math.min(t-1,e)),-(100/t)*e},_resize:function(e){var n=this.runtime,i=n.width,o=t(this.get("main"));if(!e&&o===i)return this;n.width=o;for(var s=r.children(n.wrapper),a=n.length=s.length,u=0;a>u;u++)t(s[u],"width",o);return t(n.wrapper,"width",o*a),this.emit("resize",i,o),this},_loop:function(e){var t=this.runtime,r=this.get("interval");if(t.timer=clearTimeout(t.timer),!(e||!r||0>r))if(this.get("length")<2)return void this.to(0).pause();else return void(t.timer=setTimeout(n.bind(function(){var e=this.get("index")+1;this.to(e<this.get("length")?e:0),this._loop()},this),r))},_move:function(e,t){var n=this.runtime.wrapper;if(this.get("animate"))r.setStyle(n,"transition","all "+(t||0)+"ms");return r.setStyle(n,"transform","translate3d("+e+"%, 0, 0) scale3d(1, 1, 1)"),this},sync:function(){if(this.is("render"))this.pause()._resize(!0)._move(this._percent(this.get("index"))).resume();return this},start:function(e){if(this.is("stop")&&(e||this.get("auto")))this.removeState("stop"),this._loop();return this},stop:function(e){if(!this.is("stop")&&(e||this.get("auto")))this.addState("stop"),this._loop(!0);return this},pause:function(){if(!this.is("pause")&&!this.is("stop"))this.addState("pause"),this._loop(!0);return this},resume:function(){if(this.is("pause"))this.removeState("pause"),this._loop();return this},to:function(e){if(this.is("disable"))return this;var t=this.get("index");if(e=Math.max(0,Math.min(e,this.get("length")-1)),this._move(this._percent(e),this.get("speed")),t!==e)this.set("index",e),this.emit("change",t,e);return this},prev:function(){return this.to(this.get("index")-1)},next:function(){return this.to(this.get("index")+1)}},n.inherits(e,o),require("./main").register(e),e});