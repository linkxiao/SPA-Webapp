define("saber-viewport/main",["require","saber-dom","saber-lang/extend","saber-lang/curry","saber-promise","./config","./Page","./transition","./mask"],function(require){function e(){var e=f.viewport;e.style.position="relative"}function t(e,t){if(e)e.emit("beforeleave");if(t.emit("beforeenter"),f.mask)h.show()}function n(e,t){if(f.mask)h.hide();if(e)if(e.emit("afterleave"),e.main!==t.main)e.remove();if(t.emit("afterenter"),o=null,i=t,t.hasVisited)m=m.slice(0,m.indexOf(t.url));m.push(t.url)}function r(e,t){var n=f.viewport,r=s.children(n);if(!(r.length<=0)){var i;if(arguments.length<=0)i=new l("__blank__");else i=new l(e,v,t);return r.forEach(function(e){i.main.appendChild(e)}),n.appendChild(i.main),i}}var i,o,s=require("saber-dom"),a=require("saber-lang/extend"),u=require("saber-lang/curry"),c=require("saber-promise"),f=require("./config"),l=require("./Page"),p=require("./transition"),h=require("./mask"),d={},m=[],g={before:function(e,t){var n=f.scrollContainer,r=e.data.scrollTop=n.scrollTop,i=t.data.scrollTop||0;t.main.style.marginTop=r-i+"px"},after:function(e,t){var n=f.scrollContainer;t.main.style.marginTop=null,setTimeout(function(){n.scrollTop=t.data.scrollTop||0},10)}},v={};return v.transition=function(e,r,s){if(e!==o)return c.rejected();if(s=s||{},s.frontPage=i,s.backPage=e,s.processor={},f.resetScroll)s.processor.scroll=g;return t(i,e),p(r,s).then(u(n,i,e))},{init:function(t,n){if("string"==typeof t||t instanceof String)t=document.getElementById(t);f=a(f,n),f.viewport=t,e()},front:function(e,t){if(!i&&!o){if(t=t||{},page=r(e,t),page&&t.cached)d[e]=page;return page}},load:function(e,t){if(!i)i=r();t=t||{};var n;if(!t.noCache)n=d[e];if(!n)n=new l(e,v,t);else n=n.clone(t);if(t.cached)d[e]=n;else if(d[e])delete d[e];if(o)if(o.remove(!0),d[o.url])delete d[o.url];return n.hasVisited=m.indexOf(e)>=0,o=n},delCache:function(e){if(!e)d={};else if(d[e])delete d[e]}}}),define("saber-viewport",["saber-viewport/main"],function(e){return e});