define("saber-viewport/transition/slide",["require","saber-promise","saber-dom","saber-lang/curry","saber-lang/extend","saber-run","../util","../config","../transition"],function(require){function e(e,t,n,r){var i;Object.keys(d).forEach(function(o){if(i=d[o],i[e])i[e](t,n,r)})}function t(t,n,r){var i=p.viewport,o=t.main,s=n.main,a=document.createElement("div"),u=o.offsetWidth,c={width:2*u+"px"};if(l.setStyles(a,c),a.appendChild(o),r.direction===h.LEFT)a.insertBefore(s,o);else a.appendChild(s);if(l.setStyles(o,{"float":"left",width:u+"px",position:"relative"}),l.setStyles(s,{"float":"left",width:u+"px",position:"relative"}),i.appendChild(a),e("before",t,n,r),r.direction===h.LEFT)c=r.transform?{transform:"translate3d(-"+t.main.offsetWidth+"px, 0, 0)"}:{marginLeft:-t.main.offsetWidth+"px"};else if(r.transform)c.transform="translate3d(0, 0, 0)";return l.setStyles(a,c,!0),a}function n(e,t){var n=[];return Object.keys(e).forEach(function(e){if(e in t)n.push(e)}),n}function r(e,t,r){var i=e.getBar(),o=t.getBar(),s=n(i||{},o||{}),u=[];return s.forEach(function(e){var t={front:i[e],back:o[e]};t.change=t.front.getAttribute("data-name")!==t.back.getAttribute("data-name");var n,s=t.front,c=l.getPosition(s),f=a.getStyle(s,"position");if("fixed"!==f&&"position"!==f)n=document.createElement(s.tagName),n.className=s.className,n.style.cssText+=";"+s.style.cssText+";padding:0;border:0;width:"+s.offsetWidth+"px;height:"+s.offsetHeight+"px";else n=document.createElement("ins"),n.style.display="none";if(t.frontBlock=n,s.parentNode.insertBefore(n,s),r.transform&&"fixed"===a.getStyle(t.back,"position")){var p=t.backBlock=document.createElement("ins");p.style.display="none",t.back.parentNode.insertBefore(p,t.back),document.body.appendChild(t.back)}if(n=s,t.frontCSSBack=n.style.cssText,"fixed"!==f){var h=l.getSize(n);n.style.width=h.width+"px",n.style.height=h.height+"px",n.style.position="absolute",n.style.top=c.top+"px",n.style.left=c.left+"px"}document.body.appendChild(n),!!n.offsetWidth,u.push(t)}),u}function i(t,n,r,i){var o=p.viewport,s=n.main,a=s.parentNode;r.forEach(function(e){var t=e.front,n=e.frontBlock,r=n.parentNode;t.style.cssText+=";"+e.frontCSSBack+";opacity:1",r.insertBefore(t,n),r.removeChild(n)}),l.setStyles(s,{"float":"none",width:"auto",position:"static"}),o.appendChild(s),l.setStyles(t.main,{transition:""}),o.removeChild(a),r.forEach(function(e){if(e.backBlock){var t=e.backBlock;t.parentNode.insertBefore(e.back,t),t.parentNode.removeChild(t)}}),e("after",t,n),i.fulfill()}function o(e,n){var o=n.duration||p.duration,a=n.timing||p.timing,l=n.frontPage,g=n.backPage;n.transform=void 0!==n.transform?n.transform:p.transform,n.direction=n.direction||(g.hasVisited?h.LEFT:h.RIGHT),d=c(n.processor||{},m);var v=t(l,g,n),y=r(l,g,n),b=[];y.forEach(function(e){b.push(f.transition(e.front,{opacity:0},{duration:e.change?o:.1,timing:a,delay:e.change?0:o}))});var w=n.direction===h.LEFT?0:-l.main.offsetWidth,E=n.transform?{transform:"translate3d("+w+"px, 0, 0)"}:{marginLeft:w+"px"},x=f.transition(v,E,{duration:o,timing:a});b.push(x),s.all(b).then(u(i,l,g,y,e))}var s=require("saber-promise"),a=require("saber-dom"),u=require("saber-lang/curry"),c=require("saber-lang/extend"),f=require("saber-run"),l=require("../util"),p=require("../config"),h={LEFT:"left",RIGHT:"right"},d={},m={};return m.fixed={before:function(e,t){var r=e.getFixed(),i=r.length;r=r.concat(t.getFixed());var o=e.getBar(),s=t.getBar(),u=n(o,s),f=c(o,s);Object.keys(f).forEach(function(e){if(u.indexOf(e)<0&&"fixed"===a.getStyle(f[e],"position"))r.push(f[e])}),this.fixedEles=r;var p,h,d,m=this.data=[],g=["top","left","right","bottom","width","height","position"],v=e.main;r.forEach(function(e,n){if(n>=i)v=t.main;p={},g.forEach(function(t){p[t]=e.style[t]||null}),m.push(p),d=a.position(e);for(var r=0,o=2;o>r;r++){if(h=parseInt(a.getStyle(e,"margin-"+g[r]),10),!isNaN(h))d[g[r]]-=h;if(h=parseInt(a.getStyle(v,"margin-"+g[r]),10),!isNaN(h))d[g[r]]-=h}l.setStyles(e,{position:"absolute",top:d.top+"px",left:d.left+"px",width:a.getStyle(e,"width")+"px",height:a.getStyle(e,"height")+"px",bottom:"auto",right:"atuo"})})},after:function(){var e,t=this.data;this.fixedEles.forEach(function(n,r){e=t[r],Object.keys(e).forEach(function(t){n.style[t]=e[t]})})}},require("../transition").register("slide",o),o.RIGHT=h.RIGHT,o.LEFT=h.LEFT,o});