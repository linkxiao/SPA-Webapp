function createUID(){return Date.now().toString()+Math.floor(100*Math.random())}function Requester(t,e){this.uid=createUID(),this.resolver=new Resolver,this.promise=this.resolver.promise(),this.context=e,this.handleSuccess=!1,this.handleFail=!1,t=t||{},e.emit("before",this,t),t.headers=extend({},e.data.headers,t.headers),t.method=t.method||METHOD.GET,t.headers["X-Requested-With"]="XMLHttpRequest";var n=t.url,r=t.data;if(t.method===METHOD.GET&&r){if(t.stringify!==!1&&!util.isString(r))r=util.stringify(r);n=util.append(n,r),r=""}t.data=r,this.url=n,["prefix","host"].forEach(function(t){if(t=e.data[t])n=t+n}),t.url=n,this.xhr=new Kernel(t,this),this.promise.then(bind(e.emit,e,"success",this),bind(e.emit,e,"fail",this))}var util=require("../util"),Kernel=require("./Kernel"),Resolver=require("saber-promise"),METHOD=require("../const").METHOD,bind=require("saber-lang").bind,extend=require("saber-lang").extend;Requester.prototype.handle=function(t,e,n){this.res=e;var r=this.resolver;if(t)return void r.reject(t);var i=e.status;if(i>=200&&300>i||304===i)r.fulfill(n);else r.reject(i)},Requester.prototype.then=function(t,e){return this.handleSuccess=this.handleSuccess||!!t,this.handleFail=this.handleFail||!!e,this.promise.then(t,e)},Requester.prototype.success=function(t){return this.then(t)},Requester.prototype.fail=function(t){return this.then(null,t)},Requester.prototype.ensure=function(t){return this.then(t,t)},Requester.prototype.abort=function(){this.xhr.abort()},module.exports=Requester;