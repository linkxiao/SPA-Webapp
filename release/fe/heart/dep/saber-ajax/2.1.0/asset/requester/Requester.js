define("saber-ajax/requester/Requester",["require","exports","module","../util","./Kernel","saber-promise","../const","saber-lang"],function(require,exports,module){function e(){return Date.now().toString()+Math.floor(100*Math.random())}function t(t,u){this.uid=e(),this.resolver=new i,this.promise=this.resolver.promise(),this.context=u,this.handleSuccess=!1,this.handleFail=!1,t=t||{},u.emit("before",this,t),t.headers=a({},u.data.headers,t.headers),t.method=t.method||o.GET,t.headers["X-Requested-With"]="XMLHttpRequest";var c=t.url,l=t.data;if(t.method===o.GET&&l){if(t.stringify!==!1&&!n.isString(l))l=n.stringify(l);c=n.append(c,l),l=""}t.data=l,this.url=c,["prefix","host"].forEach(function(e){if(e=u.data[e])c=e+c}),t.url=c,this.xhr=new r(t,this),this.promise.then(s(u.emit,u,"success",this),s(u.emit,u,"fail",this))}var n=require("../util"),r=require("./Kernel"),i=require("saber-promise"),o=require("../const").METHOD,s=require("saber-lang").bind,a=require("saber-lang").extend;t.prototype.handle=function(e,t,n){this.res=t;var r=this.resolver;if(e)return void r.reject(e);var i=t.status;if(i>=200&&300>i||304===i)r.fulfill(n);else r.reject(i)},t.prototype.then=function(e,t){return this.handleSuccess=this.handleSuccess||!!e,this.handleFail=this.handleFail||!!t,this.promise.then(e,t)},t.prototype.success=function(e){return this.then(e)},t.prototype.fail=function(e){return this.then(null,e)},t.prototype.ensure=function(e){return this.then(e,e)},t.prototype.abort=function(){this.xhr.abort()},module.exports=t});