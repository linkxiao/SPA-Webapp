define("saber-run/Animation",["require","saber-promise","saber-dom","saber-lang/extend","./transition"],function(require){function e(e){var t={};return e.replace(c,function(e,n,r){t[n.trim()]=r.trim()}),t}function t(e){var t=[];return Object.keys(e).forEach(function(n){t.push(n+"("+e[n]+")")}),t.join(" ")}function n(n,r){var i;return Object.keys(n).forEach(function(o){if(i=n[o],"transform"===o)n=e(r[o]||""),i=e(i),n=s(n,i),r[o]=t(n);else r[o]=i}),r}function r(e,t){this._action={},this._options={},this._defaultOptions={},this._main=e,t=t||{},this._defaultOptions.duration=t.duration||r.DURATION,this._defaultOptions.delay=t.delay||r.DELAY,this._defaultOptions.ease=u[t.ease]||u[r.EASE],this.reset(),this._promise=i.resolved(e)}var i=require("saber-promise"),o=require("saber-dom"),s=require("saber-lang/extend"),a=require("./transition"),u={"default":"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",linear:"cubic-bezier(0.250, 0.250, 0.750, 0.750)","ease-in-quad":"cubic-bezier(0.550, 0.085, 0.680, 0.530)","ease-in-cubic":"cubic-bezier(0.550, 0.055, 0.675, 0.190)","ease-in-quart":"cubic-bezier(0.895, 0.030, 0.685, 0.220)","ease-in-quint":"cubic-bezier(0.755, 0.050, 0.855, 0.060)","ease-in-sine":"cubic-bezier(0.470, 0.000, 0.745, 0.715)","ease-in-expo":"cubic-bezier(0.950, 0.050, 0.795, 0.035)","ease-in-circ":"cubic-bezier(0.600, 0.040, 0.980, 0.335)","ease-in-back":"cubic-bezier(0.600, -0.280, 0.735, 0.045)","ease-out-quad":"cubic-bezier(0.250, 0.460, 0.450, 0.940)","ease-out-cubic":"cubic-bezier(0.215, 0.610, 0.355, 1.000)","ease-out-quart":"cubic-bezier(0.165, 0.840, 0.440, 1.000)","ease-out-quint":"cubic-bezier(0.230, 1.000, 0.320, 1.000)","ease-out-sine":"cubic-bezier(0.390, 0.575, 0.565, 1.000)","ease-out-expo":"cubic-bezier(0.190, 1.000, 0.220, 1.000)","ease-out-circ":"cubic-bezier(0.075, 0.820, 0.165, 1.000)","ease-out-back":"cubic-bezier(0.175, 0.885, 0.320, 1.275)","ease-in-out-quad":"cubic-bezier(0.455, 0.030, 0.515, 0.955)","ease-in-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1.000)","ease-in-out-quart":"cubic-bezier(0.770, 0.000, 0.175, 1.000)","ease-in-out-quint":"cubic-bezier(0.860, 0.000, 0.070, 1.000)","ease-in-out-sine":"cubic-bezier(0.445, 0.050, 0.550, 0.950)","ease-in-out-expo":"cubic-bezier(1.000, 0.000, 0.000, 1.000)","ease-in-out-circ":"cubic-bezier(0.785, 0.135, 0.150, 0.860)","ease-in-out-back":"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},c=/([^(]+)\(([^)]+)\)/g;return r.DURATION=.3,r.DELAY=0,r.EASE="default",r.addAction=function(e,t){var n=this.prototype;if(!n.hasOwnProperty(e))n[e]=function(){var e,n=this,r=Array.prototype.slice.call(arguments),i=t.apply(n,r)||{};return Object.keys(i).forEach(function(t){e=i[t],n.set(t,e)}),n}},r.prototype.set=function(e,t){var r={};return r[e]=t,n(r,this._action),this},r.prototype.duration=function(e){return this._options.duration=e,this},r.prototype.delay=function(e){return this._options.delay=e,this},r.prototype.ease=function(e){return this._options.ease=u[e]||u["default"],this},r.prototype.reset=function(){return this._action={},this._options=s({},this._defaultOptions),this},r.prototype.end=function(){return a.stopTransition(this._main),this},r.prototype.run=function(){var e=this._main,t=s({},this._action);if(Object.keys(t).length<=0)return this;var r=this._options;return this.reset(),this._promise=this._promise.then(function(){var i;return Object.keys(t).forEach(function(r){if(i=t[r],"function"==typeof i)i=i(e)||{},delete t[r],n(i,t)}),a.transition(e,t,r)}),this},r.prototype.finish=function(e){return this._promise.then(e),this},r.prototype.dispose=function(){this._main=null},r.addAction("moveTo",function(e,t){var n={};if(null!=e)n.left=e+"px";if(null!=t)n.top=t+"px";return n}),r.addAction("move",function(e,t){return{move:function(n){var r={},i=o.getStyle(n,"left");if(e&&i)e+=parseInt(i,10),r.left=e+"px";if(i=o.getStyle(n,"top"),t&&i)t+=parseInt(i,10),r.top=t+"px";return r}}}),r.addAction("rotateTo",function(e){return{transfor:"rotate("+e+"deg)"}}),r.addAction("rotate",function(t){return{rotate:function(n){var r=e(o.getStyle(n,"transform"));return t+=parseInt(r.rotate||"0",10),{transform:"rotate("+t+"deg)"}}}}),r.addAction("skewTo",function(e){return{transform:"skew("+e+"deg)"}}),r.addAction("skew",function(t){return{skew:function(n){var r=e(o.getStyle(n,"transform"));return t+=parseInt(r.skew||"0",10),{transform:"skew("+t+"deg)"}}}}),r.addAction("scaleTo",function(e){return{transform:"scale("+e+")"}}),r.addAction("scale",function(t){return{scale:function(n){var r=e(o.getStyle(n,"transform"));return t+=parseFloat(r.scale||"1"),{transform:"scale("+t+")"}}}}),r});