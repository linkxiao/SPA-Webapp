define("saber-run/transition",["require","saber-dom","saber-promise"],function(require){function e(e,t){var n,r=e.getAttribute(l);if(r)r=parseInt(r,10),n=f[r];else r=f.length,e.setAttribute(l,r);n=n||[],n.push(t),f[r]=n}function t(e,t){var n=e.getAttribute(l);if(n){n=parseInt(n,10);var r=f[n]||[];r.some(function(e,n,r){return e===t&&r.splice(n,1)})}}function n(e){var t=e.getAttribute(l);if(t){t=parseInt(t,10);var n=f[t]||[];n.forEach(function(t){t.call(e,!0)})}}function r(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function i(e){if("-"!==e.charAt(0)){var t=u.style,n=r(e);if(!(n in t)){n=e.charAt(0).toUpperCase()+e.substring(1);for(var i,o=0;i=c[o];o++)if(i+n in t){e="-"+i+"-"+e;break}}}return e}var o=require("saber-dom"),s=require("saber-promise"),exports={},a=["transitionend","webkitTransitionEnd","oTransitionEnd","MSTransitionEnd","otransitionend"],u=document.createElement("div"),c=["webkit","ms","o"],f=[],l="data-transition-event";return exports.onTransitionEnd=function(t,n,r){a.forEach(function(e){t.addEventListener(e,n,r||!1)}),e(t,n)},exports.unTransitionEnd=function(e,n,r){a.forEach(function(t){e.removeEventListener(t,n,r||!1)}),t(e,n)},exports.oneTransitionEnd=function(e,t,n){var r=function(i){if(t.call(e,i)!==!1)exports.unTransitionEnd(e,r,n)};exports.onTransitionEnd(e,r,n)},exports.transition=function(e,t,n){if(!e||!t)return s.resolved(e);n=n||{},n.ease=n.ease||n.timing||"ease",n.delay=n.delay||0,n.duration=n.duration||0;var r=[],a={};Object.keys(t).forEach(function(t){a[t]=o.getStyle(e,t)}),Object.keys(t).forEach(function(n){if(a[n]!==t[n])r.push(n),o.setStyle(e,n,t[n])});var u=new s,c=function(t){var n=!0;if(t===!0||r.length<=1)u.fulfill(e),o.setStyle(e,"transition","");else r.pop(),n=!1;return n};if(r.length>0&&n.duration)exports.oneTransitionEnd(e,c),r.forEach(function(e,t){r[t]=i(e)}),o.setStyle(e,"transition-property",r.join(",")),o.setStyle(e,"transition-duration",n.duration+"s"),o.setStyle(e,"transition-timing-function",n.ease),o.setStyle(e,"transition-delay",n.delay+"s");else u.fulfill(e);return u.promise()},exports.stopTransition=function(e){o.setStyle(e,"transition-property","none"),n(e)},exports});